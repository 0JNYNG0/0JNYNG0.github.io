---
title:  "[Android] Room DB ì‚¬ìš©í•´ë³´ê¸°" 
excerpt: "Android Study"

categories:
  - Android
tags:
  - [Android]

toc: true
toc_sticky: true
 
date: 2022-12-20
last_modified_at: 2022-12-20
---
```
í•˜ë‚˜ì”© ì°¨ê·¼ì°¨ê·¼ ê°œì¸ì ìœ¼ë¡œ ê³µë¶€í•œ ê²ƒì„ ê¸°ë¡í•˜ëŠ” ë¸”ë¡œê·¸ì…ë‹ˆë‹¤.
ì°¸ê³ í•˜ì‹œê³  ì˜ëª»ë˜ê±°ë‚˜ ê³ ì³ì•¼ í•  ë¶€ë¶„ì´ ìˆë‹¤ë©´ ì§€ì  ë¶€íƒë“œë¦½ë‹ˆë‹¤!
ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤ğŸ™‚
```

## ê¸°ë³¸ ì„¸íŒ… - ì˜ì¡´ì„± ì¶”ê°€
Room DBë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ build.gradle ë‚´ìš© ìˆ˜ì •ì„ ë¨¼ì € í•´ì•¼í•œë‹¤.<br>

```kotlin
plugins {
    //

    id 'kotlin-kapt'  // ì¶”ê°€
}

dependencies {
    //

    implementation "androidx.room:room-runtime:x.x.x"  // ì¶”ê°€
    kapt "androidx.room:room-compiler:x.x.x"  // ì¶”ê°€
}
```
plugins, dependenciesì— ê°ê° ì½”ë“œë¥¼ ì¶”ê°€í•´ì£¼ê³  ì˜ì¡´ì„±ì˜ **"x.x.x"** ë²„ì „ì€ êµ¬ê¸€ ê²€ìƒ‰ì°½ì— ***Android Room***ì„ ê²€ìƒ‰ í›„ ìµœì‹  ë²„ì „ì„ ì°¾ì•„ ì ì–´ì£¼ë©´ ëœë‹¤.<br>
<br><br>

## í•„ìš”í•œ íŒŒì¼ ìƒì„±

### í…Œì´ë¸” ìƒì„±
***
ì˜ˆì‹œë¡œ, modelì´ë¼ëŠ” í´ë”ë¥¼ ë§Œë“¤ê³  History.kt ë°ì´í„° í´ë˜ìŠ¤ íŒŒì¼(ì›í•˜ëŠ” ì´ë¦„ ì‚¬ìš©)ì„ ìƒì„±í•´ì¤€ë‹¤.<br>

```kotlin
@Entity
data class History(
    @PrimaryKey val uid: Int?,
    @ColumnInfo(name = "expression") val expression: String?,
    @ColumnInfo(name = "result") val result: String?
)
```
<br><br>

### Dao ì¶”ê°€
***
- Dao(Data Access Object)ë€?<br>
    ë°ì´í„°ë² ì´ìŠ¤ì˜ dataì— ì ‘ê·¼í•˜ê¸° ìœ„í•œ ê°ì²´ë¡œ, ë¡œì§ & ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë¶„ë¦¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•œë‹¤.<br>

ì˜ˆì‹œë¡œ, daoë¼ëŠ” í´ë”ë¥¼ ë§Œë“¤ê³  HistoryDao.kt ì¸í„°í˜ì´ìŠ¤ íŒŒì¼ì„ ìƒì„±í•´ì¤€ë‹¤.<br>

```kotlin
@Dao
interface HistoryDao {
		
    @Query("SELECT * FROM history")
    fun getAll(): List<History>

    @Insert
    fun insertHistory(history: History)

    @Query("DELETE FROM history")
    fun deleteAll()

    // Additional ex. ì¶”ê°€ë¡œ ì œê±°, ì¡°ê±´ì´ ë‹¬ë¦° SELECT ë“± ì‚¬ìš©ë°©ë²•ì´ ë‹¤ì–‘í•˜ë‹¤.

    // @Delete
    // fun delete(history: History)

    // @Query("SELECT * FROM history WHERE result LIKE :result LIMIT 1")
    // fun findByResult(result: String): History

}
```
- @Queryë¼ëŠ” ì¿¼ë¦¬ ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì—¬ ì›í•˜ëŠ” DB ì‘ì—…ì„ ì‹¤í–‰í•˜ë„ë¡ í•œë‹¤.
- ë˜í•œ, Insertì™€ Delete ë“± ë‹¤ë¥¸ ì‘ì—…ë„ ê°€ëŠ¥í•˜ë‹¤.

<br><br>

### Database ìƒì„±
***
AppDatabase.ktë¼ëŠ” íŒŒì¼ì„ ìƒì„±í•´ì¤€ë‹¤.<br>

```kotlin
@Database(entities = [History::class], version = 1)
abstract class AppDatabase : RoomDatabase() {
    abstract fun historyDao(): HistoryDao
}
```

- Database ì–´ë…¸í…Œì´ì…˜ @Database()ì— ì‚¬ìš©í•˜ê³ ì í•˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ í´ë˜ìŠ¤ì™€ ë²„ì „ì„ ëª…ì‹œí•´ì£¼ë„ë¡ í•œë‹¤.
- RoomDatabase()ë¥¼ ìƒì†ë°›ëŠ” ì¶”ìƒ í´ë˜ìŠ¤ë¡œ ë§Œë“¤ê³ , ê·¸ ì•ˆì— ì´ì „ì— ë§Œë“¤ì—ˆë˜ Dao ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†ë°›ëŠ” abstract í•¨ìˆ˜ ë˜í•œ ë§Œë“¤ì–´ì¤€ë‹¤.
<br><br>

## ì•¡í‹°ë¹„í‹°ì—ì„œ RoomDB ì‚¬ìš©í•˜ê¸°
MainActivityì—ì„œ ì•ì„œ ë§Œë“¤ì–´ì¤¬ë˜ í´ë˜ìŠ¤, ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•´ë³´ì.<br>

```kotlin
lateinit var db: AppDatabase

override fun onCreate(savedInstanceState: Bundle?) {
		super.onCreate(savedInstanceState)
		setContentView(R.layout.activity_main)
		
		db = Room.databaseBuilder(
				applicationContext,
				AppDatabase::class.java,
				"historyDB"
		).build() // Database build
}
```
- ë¨¼ì € AppDatabaseì˜ ë³€ìˆ˜ë¥¼ í•˜ë‚˜ ë§Œë“¤ê³  build()í•´ì•¼ í•œë‹¤.<br>
    - Room.databaseBuilder()ì—ëŠ” ìˆœì„œëŒ€ë¡œ Context, ë°ì´í„°ë² ì´ìŠ¤ í´ë˜ìŠ¤.java, ì‚¬ìš©í•  ì´ë¦„ì„ ë„£ì–´ì£¼ê³  build()ë¥¼ í†µí•´ ë³€ìˆ˜ dbì— ë°ì´í„°ë² ì´ìŠ¤ë¥¼ í• ë‹¹í•´ì£¼ì.
<br><br>

ê·¸ë¦¬ê³  ë³¸ê²©ì ìœ¼ë¡œ DBì— ëŒ€í•œ ì²˜ë¦¬ë¥¼ í•  ë•ŒëŠ” ê¼­ ë©”ì¸ìŠ¤ë ˆë“œê°€ ì•„ë‹Œ <u>ìƒˆë¡œìš´ Threadë¥¼ ì—´ì–´ ì‘ì—…ì„ ì§„í–‰</u>ì‹œì¼œì¤˜ì•¼ í•¨ì„ ëª…ì‹¬í•˜ì. ë©”ì¸ìŠ¤ë ˆë“œì—ì„œ ë¬´ê±°ìš´ ì‘ì—…ì„ í•  ê²½ìš° ì•±ì´ ì£½ì„ ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤.<br><br><br><br><br>


ì´ì œ DBì— ê°’ì„ ë„£ì–´ì£¼ëŠ” Insert ì‘ì—…ì„ í•´ë³´ì.
```kotlin
val expressionText = expressionTextView.text.toString()
val resultText = calculateExpression()

Thread(Runnable {
    db.historyDao().insertHistory(History(null, expressionText, resultText))
}).start()
```
ìœ„ ì½”ë“œëŠ” DBì— ê°’ì„ Insertí•˜ëŠ” ì½”ë“œì´ë‹¤. DBì— ì•ì„œ ë§Œë“  Historyë¼ëŠ” ë°ì´í„° í´ë˜ìŠ¤ì˜ ìƒˆë¡œìš´ í…Œì´ë¸”ì„ í•˜ë‚˜ ì§‘ì–´ë„£ë„ë¡ í•˜ê³  ì´ëŠ” ê¼­ ìƒˆë¡œìš´ ìŠ¤ë ˆë“œ ìœ„ì—ì„œ ì§„í–‰ë˜ì–´ì•¼ í•œë‹¤.<br>
- dbì˜ abstract í•¨ìˆ˜ì¸ historyDao()ë¥¼ í†µí•´ HistoryDao ì¸í„°í˜ì´ìŠ¤ì— ì ‘ê·¼í•˜ê³  ê·¸ ì•ˆì˜ insertHistory()ë¼ëŠ” ì¸í„°í˜ì´ìŠ¤ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ê³¼ì •ì´ë‹¤.
- History()ì˜ ì²« ë²ˆì§¸ ì¸ìê°’ì€ @PrimaryKey ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ì§€ì •í•œ ê°’ì¸ë° ì´ëŠ” í•˜ë‚˜ì”© ìƒì„±ë  ë•Œë§ˆë‹¤ ìë™ìœ¼ë¡œ ê°’ì´ 1ì”© ì˜¬ë¼ê°€ë„ë¡ ì²˜ë¦¬ë˜ê¸° ë•Œë¬¸ì— nullê°’ì„ ë„£ì–´ì¤˜ë„ ë¬´ë°©í•˜ë‹¤.
<br><br><br><br>


```kotlin
fun historyButtonClicked(v: View) {
    historyLayout.isVisible = true
    historyLinearLayout.removeAllViews() // í•´ë‹¹ LinearLayoutì˜ ëª¨ë“  ë·° ì‚­ì œ

    // DBì—ì„œ ëª¨ë“  ê¸°ë¡ ê°€ì ¸ì˜¤ê¸°
    // ë·°ì— ëª¨ë“  ê¸°ë¡ í• ë‹¹í•˜ê¸°
    Thread(Runnable {
        db.historyDao().getAll().reversed().forEach {
            runOnUiThread {
                val historyView = LayoutInflater.from(this).inflate(R.layout.history_row, null, false)
                historyView.findViewById<TextView>(R.id.expressionTextView).text = it.expression
                historyView.findViewById<TextView>(R.id.resultTextView).text = "= ${it.result}"

                historyLinearLayout.addView(historyView) 
                // ìƒˆë¡œìš´ ë·°ë¥¼ ë§Œë“¤ì–´ì„œ ê°’ì„ í• ë‹¹í•˜ê³  ë ˆì´ì•„ì›ƒì— í•´ë‹¹ ë·°ë¥¼ ì¶”ê°€í•˜ëŠ” ì‘ì—…
            }
        }
    }).start()
}

fun historyClearButtonClicked(v: View) {
    historyLinearLayout.removeAllViews()
		
    Thread(Runnable {
        db.historyDao().deleteAll()
    }).start()
}
```
ìœ„ ì½”ë“œì—ì„œëŠ” historyButtonClickedí•¨ìˆ˜ì—ì„œ DB ë‚´ ëª¨ë“  ê°’ë“¤ì„ ê°€ì ¸ì˜¤ê³  historyClearButtonClicked í•¨ìˆ˜ì—ì„œ DB ë‚´ ëª¨ë“  ê°’ë“¤ì„ ì‚­ì œí•˜ëŠ” ì‘ì—…ì„ í•œë‹¤.<br>
- `db.historyDao().getAll().reversed()` -> dbë¼ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ HistoryDao ì¸í„°í˜ì´ìŠ¤ì— ì ‘ê·¼í•˜ì—¬ getAll()ì´ë¼ëŠ” ì¸í„°í˜ì´ìŠ¤ í•¨ìˆ˜ë¥¼ ì´ìš©í•´ ëª¨ë“  ê°’ì„ ê°€ì ¸ì˜¨ ë‹¤ìŒ reversed()ë¡œ ì—­ìˆœì˜ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¤ëŠ” ì½”ë“œì´ë‹¤.
- `db.historyDao().deleteAll()` -> ë§ˆì°¬ê°€ì§€ë¡œ HistoryDao ì¸í„°í˜ì´ìŠ¤ í•¨ìˆ˜ì¸ deleteAll()ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œì‹œí‚¤ëŠ” ì½”ë“œì´ë‹¤.

<br><br><br>

ì´ì²˜ëŸ¼ ê°„ë‹¨í•˜ê²Œ Room DB ì‚¬ìš© ì˜ˆì‹œë¥¼ ì•Œì•„ë³´ì•˜ë‹¤.<br>
ë°ì´í„°ë¥¼ ë‹¤ë£° í…Œì´ë¸”, DBì˜ ë°ì´í„°ì— ì ‘ê·¼í•˜ê¸° ìœ„í•œ Dao, ì‚¬ìš©í•  DB ì´ë ‡ê²Œ 3ê°œì˜ íŒŒì¼ì„ ë§Œë“¤ì–´ì¤€ë‹¤ìŒ DBë¥¼ ë¹Œë“œí•˜ê³  DBì™€ ì—°ê²°ëœ Daoì— ì ‘ê·¼ ë° ì¸í„°í˜ì´ìŠ¤ í•¨ìˆ˜ë“¤ì„ ì´ìš©í•´ DB ë°ì´í„° ì²˜ë¦¬ë¥¼ í•˜ëŠ” ê³¼ì •ì´ ì´ë£¨ì–´ì§„ë‹¤. ì´ ê³¼ì •ì„ ì´í•´í•˜ê³  ë§ì´ ì‚¬ìš©í•´ë³´ë„ë¡ í•˜ì.
<br><br><br>